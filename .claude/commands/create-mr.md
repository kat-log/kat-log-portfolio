---
description: 対話的にマージリクエスト（プルリクエスト）を作成する
---

# マージリクエスト作成

## 1. 現在のブランチ情報の確認

現在のブランチ:
!git branch --show-current

現在のブランチの状態:
!git status --porcelain

## 2. コミット履歴の確認

現在のブランチの最新 5 件のコミット:
!git log --oneline -5

main ブランチとの差分確認:
!git log main..HEAD --oneline

## 3. 変更内容の確認

main ブランチとの差分統計:
!git diff main --stat

## 4. プルリクエスト情報の生成

### A. プルリクエストのタイトル候補生成

コミットメッセージとブランチ名から適切なタイトルを生成：

- 最新のコミットメッセージを参考にする
- ブランチ名のプレフィックス（feat/, fix/, update/ など）を活用
- 変更の性質を反映した簡潔なタイトルを提案

### B. プルリクエストのボディ候補生成

変更内容を整理した詳細な説明を生成：

```markdown
## Summary
[変更内容の概要を簡潔に説明]

## Changes
[変更されたファイルとその理由を箇条書き]

## Files Changed
- `ファイル名`: 変更内容の説明

[その他必要に応じて Test Plan, Breaking Changes など]
```

## 5. ユーザー確認

### プルリクエスト作成内容の提示

以下の情報をユーザーに提示し、確認を求める：

**作成予定のプルリクエスト:**
- **ソースブランチ**: [現在のブランチ名]
- **ターゲットブランチ**: main (デフォルト)
- **タイトル**: [生成されたタイトル候補]
- **説明**: [生成されたボディ候補]

**このプルリクエストを作成しますか？**

- `Y` / `y` / `yes` / Enter → プルリクエスト作成実行
- `edit` → タイトルや説明の編集を促す
- 別のブランチ名を入力 → ターゲットブランチを変更
- `N` / `n` / `no` → キャンセル

## 実行手順

### A. 情報収集と候補生成

1. 現在のブランチ名を表示
2. main ブランチとの差分があることを確認
3. コミット履歴からタイトル候補を生成
4. 変更内容からボディ候補を生成
5. プルリクエスト作成予定内容を整理して表示

### B. ユーザー確認後の処理

**Y/y/yes/Enter の場合:**

```bash
# リモートブランチの存在確認
git ls-remote --heads origin [current-branch]

# リモートブランチが存在しない場合のみプッシュを提案
if [ $? -ne 0 ]; then
    echo "リモートブランチが存在しません。プッシュしますか？ (y/n)"
    # ユーザーが y の場合のみ git push -u origin [current-branch]
fi

# プルリクエスト作成
gh pr create --base main --title "[生成されたタイトル]" --body "[生成されたボディ]"
```

**別のブランチ名が指定された場合:**

同様の処理を指定されたターゲットブランチで実行

**edit の場合:**

タイトルと説明の編集を促し、編集後に再度確認

**N/n/No の場合:**

- 「プルリクエストの作成をキャンセルしました」と表示
- 処理を終了

### C. 作成後の確認

- プルリクエストの URL を表示
- 作成されたプルリクエストの概要を表示

**重要な注意事項:**

- プッシュは基本的に行わない（ユーザーが手動で行っている前提）
- プルリクエスト作成時にリモートブランチが存在しない場合のみプッシュを提案
- GitHub CLI (`gh`) が利用可能であることを確認
- プルリクエスト作成前に生成された内容をユーザーに必ず確認してもらう
