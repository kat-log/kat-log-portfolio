---
description: GitHub Issueのチェックリストを更新し、対応コメントを追加する
argument-hint: <Issue番号> [対応内容の説明]
---

# GitHub Issue 更新

## 1. 引数の解析

対象: $ARGUMENTS

- 引数からIssue番号を取得（例: `42`, `#42`）
- Issue番号が未指定の場合、ユーザーに確認する
- 対応内容の説明がある場合はそれも活用する

## 2. 現在の状況確認

### Issue情報の取得

```bash
gh issue view [Issue番号]
```

### 直近の変更内容の確認

現在のブランチ:
!git branch --show-current

最新のコミット:
!git log --oneline -5

関連するPR（あれば）:
```bash
gh pr list --state all --head [現在のブランチ]
```

## 3. チェックリストの分析

Issueのbodyからチェックリスト（`- [ ]` / `- [x]`）を抽出し、以下を整理：

- **チェック済み**: 既に完了している項目
- **未チェック**: まだ完了していない項目
- **今回対応した項目**: 直近の変更内容（コミット履歴、diff、会話コンテキスト）から判断

## 4. 更新内容の提示・確認

以下をユーザーに提示し、確認を求める：

**チェック済みにする項目:**
- [ ] → [x] に変更する項目を一覧表示

**追加するコメント内容:**
- 対応したPR番号
- 具体的な変更内容のサマリー

**この内容でIssueを更新しますか？**

- 修正がある場合はユーザーの指示に従って調整
- 確認が取れたら実行

## 5. 実行

### A. Issueのbody更新（チェックリスト）

1. `gh issue view [番号] --json body --jq '.body'` でbodyを取得
2. 該当するチェックリスト項目を `- [ ]` → `- [x]` に更新
3. 必要に応じて補足テキストを追加（例: `→ 京都に変更済み`）
4. 関連PRがあれば「関連PR」欄に追記
5. `gh issue edit [番号] --body-file` で更新

### B. コメントの追加

```bash
gh issue comment [番号] --body "[対応サマリー]"
```

コメントのフォーマット:

```markdown
## PR #[番号] で対応した項目

### チェック済みにした項目
- [x] 項目1
- [x] 項目2

### その他の対応
- 補足事項があれば記載
```

## 6. 完了報告

- 更新後のIssue URLを表示
- チェックリストの残り項目数を表示

**重要な注意事項:**

- `Closes #xx` / `Fix #xx` などの自動クローズキーワードは使わない（部分対応の場合にIssueが閉じてしまうため）
- チェックリストの更新内容は必ずユーザーに確認してから実行する
- Issueにチェックリストがない場合はコメント追加のみ行う
